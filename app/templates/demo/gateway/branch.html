{% extends 'demo/base.html' %}

{% block title %}{{ _('Demo Gateway Branch Tour') }}{% endblock %}

{% block styles %}
    {{ super() }}
    <style>
        .branch-hero {
            background: radial-gradient(circle at top left, rgba(99, 102, 241, 0.14), transparent 55%),
                        radial-gradient(circle at bottom right, rgba(255, 107, 53, 0.11), transparent 60%),
                        var(--bg-primary);
            color: var(--text-primary);
            padding: 4.5rem 0;
        }
        .branch-card {
            border-radius: 1rem;
            background: var(--bg-card);
            border: 1px solid rgba(148, 163, 184, 0.15);
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.22);
        }
        .stat-label {
            font-size: 0.75rem;
            letter-spacing: 0.08em;
            text-transform: uppercase;
            color: var(--text-muted);
        }
        .mini-chart {
            height: 52px;
            background: rgba(148, 163, 184, 0.08);
            border-radius: 12px;
        }
        .table-demo thead th {
            color: var(--text-muted);
            font-weight: 600;
            text-transform: uppercase;
            font-size: 0.72rem;
        }
        .badge-soft {
            background-color: rgba(148, 163, 184, 0.12);
            color: var(--text-muted);
            border: 1px solid rgba(148, 163, 184, 0.18);
        }
    </style>
{% endblock %}

{% block demo_content %}
<div class="branch-hero">
    <div class="container">
        <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-4">
            <div>
                <div class="demo-badge mb-3">
                    <i class="bi bi-diagram-3"></i>
                    {{ _('Branch Oversight Tour') }}
                </div>
                <h1 class="display-5 fw-semibold mb-3 text-white">
                    {{ _('Monitor Demo Client Performance') }}
                </h1>
                <p class="lead text-white-50 mb-0">
                    {{ _('This tour mirrors what a branch superadmin sees: volume insights, pending approvals, and client profitability snapshots.') }}
                </p>
            </div>
            <div class="text-lg-end">
                <a href="{{ url_for('demo_gateway.landing') }}" class="btn btn-outline-light btn-lg">
                    <i class="bi bi-arrow-left me-2"></i>{{ _('Back to Demo Hub') }}
                </a>
                {% if demo_branch %}
                <a href="{{ url_for('branch.dashboard') }}" class="btn btn-primary btn-lg ms-lg-3">
                    <i class="bi bi-speedometer2 me-2"></i>{{ _('Open Real Branch Dashboard') }}
                </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="py-5">
    <div class="container">
        {% if not demo_branch %}
            <div class="alert alert-warning">
                {{ _('Demo branch records are not available. Please seed demo data to enable the branch tour.') }}
            </div>
        {% else %}
        <div class="row g-4">
            <div class="col-md-3">
                <div class="branch-card h-100 p-4">
                    <p class="stat-label mb-1">{{ _('Active Clients') }}</p>
                    <h3 class="text-white mb-0">{{ stats.total_clients if stats else '—' }}</h3>
                    <p class="text-muted mb-0">{{ demo_branch.name }}</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="branch-card h-100 p-4">
                    <p class="stat-label mb-1">{{ _('30 Day Deposits') }}</p>
                    <h3 class="text-white mb-0">${{ '%.2f'|format(stats.deposit_volume) if stats else '0.00' }}</h3>
                    <p class="text-muted mb-0">{{ _('Approved volume only') }}</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="branch-card h-100 p-4">
                    <p class="stat-label mb-1">{{ _('30 Day Withdrawals') }}</p>
                    <h3 class="text-white mb-0">${{ '%.2f'|format(stats.withdrawal_volume) if stats else '0.00' }}</h3>
                    <p class="text-muted mb-0">{{ _('Approved payouts') }}</p>
                </div>
            </div>
            <div class="col-md-3">
                <div class="branch-card h-100 p-4">
                    <p class="stat-label mb-1">{{ _('Commission Estimate') }}</p>
                    <h3 class="text-white mb-0">${{ '%.2f'|format(stats.commission_estimate) if stats else '0.00' }}</h3>
                    <p class="text-muted mb-0">{{ _('Assumes 3.5% commission') }}</p>
                </div>
            </div>
        </div>

        <div class="row g-4 mt-1">
            <div class="col-lg-8">
                <div class="branch-card p-4 h-100">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <div>
                            <h5 class="text-white mb-1">{{ _('Recent Transactions') }}</h5>
                            <p class="text-muted mb-0">{{ _('Sample of the last few deposits and withdrawals across demo clients') }}</p>
                        </div>
                        <span class="badge badge-soft">{{ _('Demo Data') }}</span>
                    </div>

                    {% if stats and stats.recent_transactions %}
                        <div class="table-responsive">
                            <table class="table table-demo align-middle mb-0">
                                <thead>
                                    <tr>
                                        <th>{{ _('Type') }}</th>
                                        <th>{{ _('Client') }}</th>
                                        <th class="text-end">{{ _('Amount') }}</th>
                                        <th class="text-center">{{ _('Status') }}</th>
                                        <th>{{ _('Created') }}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for tx in stats.recent_transactions %}
                                    <tr>
                                        <td>
                                            <span class="badge {{ 'bg-success' if tx.type == 'Deposit' else 'bg-warning text-dark' }}">
                                                {{ tx.type }}
                                            </span>
                                        </td>
                                        <td class="text-muted">{{ tx.client }}</td>
                                        <td class="text-white text-end">{{ '%.2f'|format(tx.amount) }} {{ tx.currency }}</td>
                                        <td class="text-center">
                                            <span class="badge badge-soft">{{ tx.status|replace('_', ' ')|title }}</span>
                                        </td>
                                        <td class="text-muted">{{ tx.created_at or '—' }}</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    {% else %}
                        <div class="text-center py-5 text-muted">
                            <i class="bi bi-activity display-6 d-block mb-3"></i>
                            {{ _('Seed a few demo payments to populate transaction history.') }}
                        </div>
                    {% endif %}
                </div>
            </div>
            <div class="col-lg-4">
                <div class="branch-card p-4 h-100">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <h5 class="text-white mb-0">{{ _('Top Clients by Volume') }}</h5>
                        <span class="badge badge-soft">{{ _('Last 30 Days') }}</span>
                    </div>
                    {% if stats and stats.top_clients %}
                        <ul class="list-unstyled mb-0">
                            {% for client in stats.top_clients %}
                            <li class="d-flex align-items-center justify-content-between py-3 border-bottom border-secondary">
                                <div>
                                    <h6 class="text-white mb-1">{{ client.name }}</h6>
                                    <span class="text-muted">{{ _('Deposits') }}</span>
                                </div>
                                <div class="text-end">
                                    <span class="fw-semibold text-white">${{ '%.2f'|format(client.deposit_total) }}</span>
                                </div>
                            </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <div class="text-muted">
                            {{ _('Once demo payments are seeded, this list will highlight your top performers.') }}
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="row g-4 mt-1">
            <div class="col-md-6">
                <div class="branch-card p-4 h-100">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <h5 class="text-white mb-0">{{ _('Operational Workload') }}</h5>
                        <span class="badge badge-soft">
                            <i class="bi bi-bell me-1"></i>{{ _('Pending') }}: {{ stats.pending_withdrawals if stats else 0 }}
                        </span>
                    </div>
                    <p class="text-muted mb-0">
                        {{ _('Pending withdrawals require manual approval. This dashboard strings together alerts so branch teams never miss a payout request.') }}
                    </p>
                </div>
            </div>
            <div class="col-md-6">
                <div class="branch-card p-4 h-100">
                    <div class="d-flex align-items-center justify-content-between mb-3">
                        <h5 class="text-white mb-0">{{ _('Teminci & Bank Gateway Readiness') }}</h5>
                        <span class="badge badge-soft">
                            <i class="bi bi-link-45deg me-1"></i>{{ _('Integrated') }}
                        </span>
                    </div>
                    <p class="text-muted mb-0">
                        {{ _('Branch teams manage Teminci bank accounts here. In this demo, client-facing bank keys remain concealed, letting you highlight security-by-design.') }}
                    </p>
                </div>
            </div>
        </div>

        {% endif %}
    </div>
</div>
{% endblock %}
